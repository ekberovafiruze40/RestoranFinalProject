<!DOCTYPE html>
<html
        xmlns:th="http://thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{/dashboard/layout}">
<head>
    <meta charset="UTF-8">
    <title>User</title>
</head>
<body >
<div layout:fragment="body">
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Email</th>
                <th scope="col">First Name</th>
                <th scope="col">Last Name</th>
                <th scope="col">Roles</th>
                <th scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            <!-- Burada users siyahısı foreach ilə gəzilir -->
            <tr th:each="user, iterStat : ${users}">
                <th scope="row" th:text="${iterStat.index + 1}">1</th>
                <td th:text="${user.email}">email@example.com</td>
                <td th:text="${user.firstName}">Mark</td>
                <td th:text="${user.lastName}">Smith</td>
                <td>
                    <!-- Mövcud rolları göstərmək -->
                    <span th:each="role : ${user.roles}" th:text="${role.name}">ROLE_USER</span>
                </td>
                <td>
                    <!-- Sil düyməsi -->
                    <form th:action="@{/admin/user/delete/{id}(id=${user.id})}" method="post" style="display:inline-block;">
                        <button type="submit" onclick="return confirm('İstifadəçini silmək istədiyinizə əminsiniz?')">
                            Sil
                        </button>
                    </form>

                    <!-- Rol dəyişmə (select) -->
                    <form th:action="@{/admin/user/role/{id}(id=${user.id})}" method="post" style="display:inline-block; margin-left:5px;">
                        <select name="role" onchange="this.form.submit()">
                            <<option th:selected="${user.roles.?[name=='ROLE_USER'].size() > 0}" value="ROLE_USER">User</option>
                            <option th:selected="${user.roles.?[name=='ROLE_ADMIN'].size() > 0}" value="ROLE_ADMIN">Admin</option>
                            <option th:selected="${user.roles.?[name=='ROLE_EDITOR'].size() > 0}" value="ROLE_EDITOR">Editor</option>
                        </select>
                    </form>

                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

</body>
</html>